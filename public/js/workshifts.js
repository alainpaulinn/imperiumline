var app = new Vue({
    el: '#vueApp',
    data: {
        times: [{
            hour: '00',
            isActive: false
        }, {
            hour: '01',
            isActive: false
        }, {
            hour: '02',
            isActive: false
        }, {
            hour: '03',
            isActive: false
        }, {
            hour: '04',
            isActive: false
        }, {
            hour: '05',
            isActive: false
        }, {
            hour: '06',
            isActive: false
        }, {
            hour: '07',
            isActive: false
        }, {
            hour: '08',
            isActive: false
        }, {
            hour: '09',
            isActive: false
        }, {
            hour: '10',
            isActive: false
        }, {
            hour: '11',
            isActive: false
        }, {
            hour: '12',
            isActive: false
        }, {
            hour: '13',
            isActive: false
        }, {
            hour: '14',
            isActive: false
        }, {
            hour: '15',
            isActive: false
        }, {
            hour: '16',
            isActive: false
        }, {
            hour: '17',
            isActive: false
        }, {
            hour: '18',
            isActive: false
        }, {
            hour: '19',
            isActive: false
        }, {
            hour: '20',
            isActive: false
        }, {
            hour: '21',
            isActive: false
        }, {
            hour: '22',
            isActive: false
        }, {
            hour: '23',
            isActive: false
        }

        ],
        days: [{
            dayName: "Monday",
            isActive: false,
            dayNumber: 0,
            times: [{
                hour: 0,
                isActive: false
            }, {
                hour: 1,
                isActive: false
            }, {
                hour: 2,
                isActive: false
            }, {
                hour: 3,
                isActive: false
            }, {
                hour: 4,
                isActive: false
            }, {
                hour: 5,
                isActive: false
            }, {
                hour: 6,
                isActive: false
            }, {
                hour: 7,
                isActive: false
            }, {
                hour: 8,
                isActive: false
            }, {
                hour: 9,
                isActive: false
            }, {
                hour: 10,
                isActive: false
            }, {
                hour: 11,
                isActive: false
            }, {
                hour: 12,
                isActive: false
            }, {
                hour: 13,
                isActive: false
            }, {
                hour: 14,
                isActive: false
            }, {
                hour: 15,
                isActive: false
            }, {
                hour: 16,
                isActive: false
            }, {
                hour: 17,
                isActive: false
            }, {
                hour: 18,
                isActive: false
            }, {
                hour: 19,
                isActive: false
            }, {
                hour: 20,
                isActive: false
            }, {
                hour: 21,
                isActive: false
            }, {
                hour: 22,
                isActive: false
            }, {
                hour: 23,
                isActive: false
            }

            ]
        }, {
            dayName: "Tuesday",
            isActive: false,
            dayNumber: 1,
            times: [{
                hour: 0,
                isActive: false
            }, {
                hour: 1,
                isActive: false
            }, {
                hour: 2,
                isActive: false
            }, {
                hour: 3,
                isActive: false
            }, {
                hour: 4,
                isActive: false
            }, {
                hour: 5,
                isActive: false
            }, {
                hour: 6,
                isActive: false
            }, {
                hour: 7,
                isActive: false
            }, {
                hour: 8,
                isActive: false
            }, {
                hour: 9,
                isActive: false
            }, {
                hour: 10,
                isActive: false
            }, {
                hour: 11,
                isActive: false
            }, {
                hour: 12,
                isActive: false
            }, {
                hour: 13,
                isActive: false
            }, {
                hour: 14,
                isActive: false
            }, {
                hour: 15,
                isActive: false
            }, {
                hour: 16,
                isActive: false
            }, {
                hour: 17,
                isActive: false
            }, {
                hour: 18,
                isActive: false
            }, {
                hour: 19,
                isActive: false
            }, {
                hour: 20,
                isActive: false
            }, {
                hour: 21,
                isActive: false
            }, {
                hour: 22,
                isActive: false
            }, {
                hour: 23,
                isActive: false
            }

            ]
        }, {
            dayName: "Wednesday",
            isActive: false,
            dayNumber: 2,
            times: [{
                hour: 0,
                isActive: false
            }, {
                hour: 1,
                isActive: false
            }, {
                hour: 2,
                isActive: false
            }, {
                hour: 3,
                isActive: false
            }, {
                hour: 4,
                isActive: false
            }, {
                hour: 5,
                isActive: false
            }, {
                hour: 6,
                isActive: false
            }, {
                hour: 7,
                isActive: false
            }, {
                hour: 8,
                isActive: false
            }, {
                hour: 9,
                isActive: false
            }, {
                hour: 10,
                isActive: false
            }, {
                hour: 11,
                isActive: false
            }, {
                hour: 12,
                isActive: false
            }, {
                hour: 13,
                isActive: false
            }, {
                hour: 14,
                isActive: false
            }, {
                hour: 15,
                isActive: false
            }, {
                hour: 16,
                isActive: false
            }, {
                hour: 17,
                isActive: false
            }, {
                hour: 18,
                isActive: false
            }, {
                hour: 19,
                isActive: false
            }, {
                hour: 20,
                isActive: false
            }, {
                hour: 21,
                isActive: false
            }, {
                hour: 22,
                isActive: false
            }, {
                hour: 23,
                isActive: false
            }

            ]
        }, {
            dayName: "Thursday",
            isActive: false,
            dayNumber: 3,
            times: [{
                hour: 0,
                isActive: false
            }, {
                hour: 1,
                isActive: false
            }, {
                hour: 2,
                isActive: false
            }, {
                hour: 3,
                isActive: false
            }, {
                hour: 4,
                isActive: false
            }, {
                hour: 5,
                isActive: false
            }, {
                hour: 6,
                isActive: false
            }, {
                hour: 7,
                isActive: false
            }, {
                hour: 8,
                isActive: false
            }, {
                hour: 9,
                isActive: false
            }, {
                hour: 10,
                isActive: false
            }, {
                hour: 11,
                isActive: false
            }, {
                hour: 12,
                isActive: false
            }, {
                hour: 13,
                isActive: false
            }, {
                hour: 14,
                isActive: false
            }, {
                hour: 15,
                isActive: false
            }, {
                hour: 16,
                isActive: false
            }, {
                hour: 17,
                isActive: false
            }, {
                hour: 18,
                isActive: false
            }, {
                hour: 19,
                isActive: false
            }, {
                hour: 20,
                isActive: false
            }, {
                hour: 21,
                isActive: false
            }, {
                hour: 22,
                isActive: false
            }, {
                hour: 23,
                isActive: false
            }

            ]
        }, {
            dayName: "Friday",
            isActive: false,
            dayNumber: 4,
            times: [{
                hour: 0,
                isActive: false
            }, {
                hour: 1,
                isActive: false
            }, {
                hour: 2,
                isActive: false
            }, {
                hour: 3,
                isActive: false
            }, {
                hour: 4,
                isActive: false
            }, {
                hour: 5,
                isActive: false
            }, {
                hour: 6,
                isActive: false
            }, {
                hour: 7,
                isActive: false
            }, {
                hour: 8,
                isActive: false
            }, {
                hour: 9,
                isActive: false
            }, {
                hour: 10,
                isActive: false
            }, {
                hour: 11,
                isActive: false
            }, {
                hour: 12,
                isActive: false
            }, {
                hour: 13,
                isActive: false
            }, {
                hour: 14,
                isActive: false
            }, {
                hour: 15,
                isActive: false
            }, {
                hour: 16,
                isActive: false
            }, {
                hour: 17,
                isActive: false
            }, {
                hour: 18,
                isActive: false
            }, {
                hour: 19,
                isActive: false
            }, {
                hour: 20,
                isActive: false
            }, {
                hour: 21,
                isActive: false
            }, {
                hour: 22,
                isActive: false
            }, {
                hour: 23,
                isActive: false
            }

            ]
        }, {
            dayName: "Saturday",
            isActive: false,
            dayNumber: 5,
            times: [{
                hour: 0,
                isActive: false
            }, {
                hour: 1,
                isActive: false
            }, {
                hour: 2,
                isActive: false
            }, {
                hour: 3,
                isActive: false
            }, {
                hour: 4,
                isActive: false
            }, {
                hour: 5,
                isActive: false
            }, {
                hour: 6,
                isActive: false
            }, {
                hour: 7,
                isActive: false
            }, {
                hour: 8,
                isActive: false
            }, {
                hour: 9,
                isActive: false
            }, {
                hour: 10,
                isActive: false
            }, {
                hour: 11,
                isActive: false
            }, {
                hour: 12,
                isActive: false
            }, {
                hour: 13,
                isActive: false
            }, {
                hour: 14,
                isActive: false
            }, {
                hour: 15,
                isActive: false
            }, {
                hour: 16,
                isActive: false
            }, {
                hour: 17,
                isActive: false
            }, {
                hour: 18,
                isActive: false
            }, {
                hour: 19,
                isActive: false
            }, {
                hour: 20,
                isActive: false
            }, {
                hour: 21,
                isActive: false
            }, {
                hour: 22,
                isActive: false
            }, {
                hour: 23,
                isActive: false
            }

            ]
        }, {
            dayName: "Sunday",
            isActive: false,
            dayNumber: 6,
            times: [{
                hour: 0,
                isActive: false
            }, {
                hour: 1,
                isActive: false
            }, {
                hour: 2,
                isActive: false
            }, {
                hour: 3,
                isActive: false
            }, {
                hour: 4,
                isActive: false
            }, {
                hour: 5,
                isActive: false
            }, {
                hour: 6,
                isActive: false
            }, {
                hour: 7,
                isActive: false
            }, {
                hour: 8,
                isActive: false
            }, {
                hour: 9,
                isActive: false
            }, {
                hour: 10,
                isActive: false
            }, {
                hour: 11,
                isActive: false
            }, {
                hour: 12,
                isActive: false
            }, {
                hour: 13,
                isActive: false
            }, {
                hour: 14,
                isActive: false
            }, {
                hour: 15,
                isActive: false
            }, {
                hour: 16,
                isActive: false
            }, {
                hour: 17,
                isActive: false
            }, {
                hour: 18,
                isActive: false
            }, {
                hour: 19,
                isActive: false
            }, {
                hour: 20,
                isActive: false
            }, {
                hour: 21,
                isActive: false
            }, {
                hour: 22,
                isActive: false
            }, {
                hour: 23,
                isActive: false
            }

            ]
        },],
        counter: 1,
        selected: '',
        hourStart: '',
        hourEnd: '',
        dayStart: '',
        dayEnd: '',
        dayPreStart: '',
        hourPreStart: '',
        dayPreEnd: '',
        hourPreEnd: '',
        elementMove: '',
        dayCheck: {
            isActive: false
        }
    },
    methods: {
        activateDay: function () {
            element = event.currentTarget
            value = parseInt(element.getAttribute('value'))
            this.days[value].isActive = !this.days[value].isActive
            if (this.days[value].isActive === true) {
                for (i = 0; i < this.times.length; i++) {
                    this.days[value].times[i].isActive = true
                }
            } else if (this.days[value].isActive === false) {
                for (i = 0; i < this.times.length; i++) {
                    this.days[value].times[i].isActive = false
                }
            }
        },
        mouseMove: function () {
            element5 = event.target
            this.elementMove = element5
            if (element5.getAttribute('data') == 'day') {
                hourPreStart = parseInt(element5.getAttribute('value'))
                dayPreStart = parseInt(element5.parentElement.firstChild.getAttribute('day-value'));
                this.hourPreEnd = hourPreStart
                this.dayPreEnd = dayPreStart
            }
            // console.log(this.hourPreStart, this.dayPreStart, this.hourPreEnd, this.dayPreEnd)
        },
        mouseDown: function () {
            element1 = event.target
            if (element1.getAttribute('data') == 'day') {
                hourStart = parseInt(element1.getAttribute('value'))
                dayStart = parseInt(element1.parentElement.firstChild.getAttribute('day-value'));
                this.hourStart = hourStart
                this.dayStart = dayStart
                this.hourPreStart = hourStart
                this.dayPreStart = dayStart
                if (element1.getAttribute('class') == 'dayparts-cell') {
                    this.dayCheck.isActive = true
                } else (this.dayCheck.isActive = false)
            }
            element1.addEventListener("mousemove", function () {
                console.log('huy')
                for (i = this.dayPreStart; i <= this.dayPreEnd; i++) {
                    for (j = this.hourPreStart; j <= this.hourPreEnd; j++) {
                        this.days[i].times[j].isActive = true
                    }
                }
            })
        },
        mouseUp: function () {

            element2 = event.target
            if (element2.getAttribute('data') == 'day') {
                hourEnd = parseInt(element2.getAttribute('value'))
                dayEnd = parseInt(element2.parentElement.firstChild.getAttribute('day-value'))
                this.hourEnd = hourEnd
                this.dayEnd = dayEnd
                if (this.dayStart == this.dayEnd && this.hourStart == this.hourEnd) {
                    console.log('0')
                    this.days[this.dayStart].times[this.hourStart].isActive = this.dayCheck.isActive
                } else if (this.dayStart <= this.dayEnd && this.hourStart <= this.hourEnd) {
                    console.log('1')
                    for (i = this.dayStart; i <= this.dayEnd; i++) {
                        for (j = this.hourStart; j <= this.hourEnd; j++) {
                            this.days[i].times[j].isActive = this.dayCheck.isActive
                        }
                    }
                } else if (this.dayStart >= this.dayEnd && this.hourStart <= this.hourEnd) {
                    console.log('2')
                    for (i = this.dayStart; i >= this.dayEnd; i--) {
                        for (j = this.hourStart; j <= this.hourEnd; j++) {
                            this.days[i].times[j].isActive = this.dayCheck.isActive
                        }
                    }
                } else if (this.hourStart > this.hourEnd && this.dayStart < this.dayEnd) {
                    console.log('3')
                    for (i = this.dayStart; i <= this.dayEnd; i++) {
                        for (j = this.hourStart; j >= this.hourEnd; j--) {
                            this.days[i].times[j].isActive = this.dayCheck.isActive
                        }
                    }
                } else if (this.dayStart >= this.dayEnd && this.hourStart >= this.hourEnd) {
                    console.log('4')
                    for (i = this.dayStart; i >= this.dayEnd; i--) {
                        for (j = this.hourStart; j >= this.hourEnd; j--) {
                            this.days[i].times[j].isActive = this.dayCheck.isActive
                        }
                    }
                }
            }
        },

        setTime: function () {
            element = event.currentTarget
            value = parseInt(element.getAttribute('value'))
            this.times[value].isActive = !this.times[value].isActive
            if (this.times[value].isActive === true) {
                for (i = 0; i < 7; i++) {
                    this.days[i].times[value].isActive = true
                }
            } else if (this.times[value].isActive === false) {
                for (i = 0; i < 7; i++) {
                    this.days[i].times[value].isActive = false
                }
            }
        },
        clearAll: function () {
            for (i = 0; i < this.days.length; i++) {
                for (j = 0; j < this.days[0].times.length; j++) {
                    this.days[i].isActive = false
                    this.days[i].times[j].isActive = false
                }
            }
        },

        selectedFunc: function () {
            if (this.selected == '0') {
                for (i = 0; i < this.days.length; i++) {
                    for (j = 0; j < this.days[0].times.length; j++) {
                        this.days[i].isActive = false
                        this.days[i].times[j].isActive = false
                    }
                }
            } else if (this.selected == '1') {
                for (i = 0; i < this.days.length; i++) {
                    for (j = 12; j < 18; j++) {
                        this.days[i].isActive = true
                        this.days[i].times[j].isActive = true
                    }
                }
            } else if (this.selected == '2') {
                for (i = 0; i < this.days.length; i++) {
                    for (j = 18; j < 24; j++) {
                        this.days[i].isActive = true
                        this.days[i].times[j].isActive = true
                    }
                }
            } else if (this.selected == '3') {
                for (i = 0; i < this.days.length; i++) {
                    for (j = 6; j < 12; j++) {
                        this.days[i].isActive = true
                        this.days[i].times[j].isActive = true
                    }
                }
            } else if (this.selected == '4') {
                for (i = 0; i < 5; i++) {
                    for (j = 0; j < this.days[0].times.length; j++) {
                        this.days[i].isActive = true
                        this.days[i].times[j].isActive = true
                    }
                }
            } else if (this.selected == '5') {
                for (i = 5; i < 7; i++) {
                    for (j = 0; j < this.days[0].times.length; j++) {
                        this.days[i].isActive = true
                        this.days[i].times[j].isActive = true
                    }
                }
            } else if (this.selected == '6') {
                for (i = 4; i < 7; i++) {
                    for (j = 0; j < this.days[0].times.length; j++) {
                        this.days[i].isActive = true
                        this.days[i].times[j].isActive = true
                    }
                }
            }
        }

    }
})

let daysInAWeek = 7;
let daysOfWeek = [
    {
        dayId: 1,
        dayName: "Monday",
    },
    {
        dayId: 2,
        dayName: "Tuesday"
    },
    {
        dayId: 3,
        dayName: "Wednesday"
    },
    {
        dayId: 4,
        dayName: "Thursday"
    },
    {
        dayId: 5,
        dayName: "Friday"
    },
    {
        dayId: 6,
        dayName: "Saturday"
    },
    {
        dayId: 7,
        dayName: "Sunday"
    },
]
let hoursInADay = 24;
let minutesInADay = hoursInADay * 60;
let smallestTimeUnit = 60; //counted in minutes
let sectionsInADay = minutesInADay / smallestTimeUnit;
let earliestStartTime = '00:00:00';
let latestFinishTime = '23:59:59';

let workshiftMatrixCanvas = document.getElementById('workshiftMatrixCanvas')

let isSelecting = false;
let isDeselecting = false;



let startSelectionDay;
let startSelectionTime;
let endSelectionDay;
let endSelectionTime;

//let active_test = event.target.classList.contains("active-test")

workshiftMatrixCanvas.addEventListener('mousedown', function (event){
    let onDay = event.target.getAttribute("data-day")
    let onTime = event.target.getAttribute("data-time")
    console.log('data-day',onDay,'data-time',onTime)
    if(!onDay || !onTime) return;


    if(event.target.classList.contains("active-test")){
        isDeselecting = true;
        isSelecting = false;
    }
    else{
        isDeselecting = false;
        isSelecting = true;
    }
    
    startSelectionDay = parseInt(onDay)
    startSelectionTime = parseInt(onTime)


})

workshiftMatrixCanvas.addEventListener('mousemove', function (event){
    if(isSelecting == false && isDeselecting == false) return;

    let onDay = event.target.getAttribute("data-day")
    let onTime = event.target.getAttribute("data-time")
    if(!onDay || !onTime) return;
    
    endSelectionDay = parseInt(onDay)
    endSelectionTime = parseInt(onTime)

    let smallestTime = findSmallest([startSelectionTime,endSelectionTime])
    let greatestTime = findGreatest([startSelectionTime,endSelectionTime])

    let smallestDay = findSmallest([startSelectionDay,endSelectionDay])
    let greatestDay = findGreatest([startSelectionDay,endSelectionDay])

    for (let d = smallestDay; d <= greatestDay; d++) {
        for (let t = smallestTime; t <= greatestTime; t++) {
            let byPassedElement = document.getElementById(Math.abs(d)+""+Math.abs(t)+"ScheduleDay")
            if(!byPassedElement) return;

            let previousSibling = byPassedElement.previousSibling
            let nextSibling = byPassedElement.nextSibling

            //if(previousSibling || nextSibling)
            let prevActiveElement = false;
            let nextActiveElement = false;
            
            if(previousSibling) prevActiveElement = previousSibling.classList.contains("active-test")
            if(nextSibling) nextActiveElement = nextSibling.classList.contains("active-test")

            

            if(isSelecting == true) {
                byPassedElement.classList.add("active-test")
                if(prevActiveElement != false) byPassedElement.classList.add("active-test-last")
                if(nextActiveElement != false) byPassedElement.classList.add("active-test-first")
                if(nextActiveElement != false && prevActiveElement != false){
                    byPassedElement.classList.remove("active-test-first")
                    byPassedElement.classList.remove("active-test-last")
                } 
                
            }
            if(isDeselecting == true) {
                byPassedElement.classList.remove("active-test")
                //if(!prevActiveElement) byPassedElement.classList.remove("active-test-first")
                //if(!nextActiveElement) byPassedElement.classList.remove("active-test-last")
            }

        }
    }
})

function findSmallest(numberArray){
    return Math.min(...numberArray)
}
function findGreatest(numberArray){
    return Math.max(...numberArray)
}


workshiftMatrixCanvas.addEventListener('mouseup', function (event){
    isSelecting = false;
    isDeselecting = false;
})

for (let j = 0; j < daysOfWeek.length; j++) {
    let oneDay = document.createElement('div')
    oneDay.classList.add("day-test")
    workshiftMatrixCanvas.append(oneDay)

    let dayNameDiv = document.createElement("div")
    dayNameDiv.classList.add("dayName-test")
    dayNameDiv.textContent = daysOfWeek[j].dayName;

    oneDay.append(dayNameDiv)

    for (let d = 0; d < sectionsInADay; d++) {
        let shortestTimeUnit = document.createElement("div")
        shortestTimeUnit.classList.add("dayparts-cell-test")
        shortestTimeUnit.id = daysOfWeek[j].dayId + "" + (d) + "ScheduleDay";
        shortestTimeUnit.setAttribute("data-day", daysOfWeek[j].dayId)
        shortestTimeUnit.setAttribute("data-time", (d))// + "-" + (smallestTimeUnit-1))
        oneDay.append(shortestTimeUnit)

        shortestTimeUnit.addEventListener("click", function (){
            console.log('day: ', daysOfWeek[j].dayName, daysOfWeek[j].dayId)
            console.log('smallest Time Unit: ', (d+1))
            shortestTimeUnit.classList.toggle("active-test")
            shortestTimeUnit.classList.toggle("active-test-last")
            //console.log('sequence: ')
        })
    }
    
}